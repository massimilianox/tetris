'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}var Piece=exports.Piece=function(){var nextPiece=false;var nextShape=document.querySelector('#next-piece');var pieces=[];var Shape=function(){function Shape(){_classCallCheck(this,Shape)}_createClass(Shape,null,[{key:'I',value:function I(){return[[[0,1],[0,1],[0,1],[0,1]],[[0,0,0,0],[1,1,1,1]]]}},{key:'J',value:function J(){return[[[0,1],[0,1],[1,1]],[[1,0,0],[1,1,1]],[[0,1,1],[0,1,0],[0,1,0]],[[1,1,1],[0,0,1]]]}},{key:'L',value:function L(){return[[[1,0],[1,0],[1,1]],[[1,1,1],[1,0,0]],[[0,1,1],[0,0,1],[0,0,1]],[[0,0,1],[1,1,1]]]}},{key:'O',value:function O(){return[[[1,1],[1,1]]]}},{key:'S',value:function S(){return[[[0,1,1],[1,1,0]],[[0,1,0],[0,1,1],[0,0,1]],[[0,0,0],[0,1,1],[1,1,0]],[[1,0],[1,1],[0,1]]]}},{key:'T',value:function T(){return[[[1,1,1],[0,1,0]],[[0,0,1],[0,1,1],[0,0,1]],[[0,0,0],[0,1,0],[1,1,1]],[[1,0],[1,1],[1,0]]]}},{key:'Z',value:function Z(){return[[[1,1,0],[0,1,1]],[[0,0,1],[0,1,1],[0,1,0]],[[0,0,0],[1,1,0],[0,1,1]],[[0,1],[1,1],[1,0]]]}}]);return Shape}();return function(){function Piece(updateBoard){_classCallCheck(this,Piece);this.ub=updateBoard;this.bs=document.querySelector('#start-game');pieces=[{simb:'I',shape:Shape.I(),color:this.ub.dm.colorI},{simb:'J',shape:Shape.J(),color:this.ub.dm.colorJ},{simb:'L',shape:Shape.L(),color:this.ub.dm.colorL},{simb:'O',shape:Shape.O(),color:this.ub.dm.colorO},{simb:'S',shape:Shape.S(),color:this.ub.dm.colorS},{simb:'T',shape:Shape.T(),color:this.ub.dm.colorT},{simb:'Z',shape:Shape.Z(),color:this.ub.dm.colorZ}]}_createClass(Piece,[{key:'initPiece',value:function initPiece(){this.currentPiece=nextPiece?nextPiece:pieces[Math.round(Math.random()*(pieces.length-1))];nextPiece=pieces[Math.round(Math.random()*(pieces.length-1))];this.shape=this.currentPiece.shape[0];this.x=Math.ceil((this.ub.dm.canvasColumns-this.shape[0].length)/2);this.y=-this.shape.length;this.color=this.currentPiece.color;this.rotation=0;nextShape.src='img/'+nextPiece.simb+'.png'}},{key:'drawPiece',value:function drawPiece(){for(var dy=0;dy<this.shape.length;dy++){for(var dx=0;dx<this.shape[dy].length;dx++){if(this.shape[dy][dx]){this.ub.drawSquare(this.x+dx,this.y+dy,this.color)}}}}},{key:'collisionWallRight',value:function collisionWallRight(){for(var y=0;y<this.shape.length;y++){for(var x=0;x<this.shape[y].length;x++){if(this.shape[y][x]&&(this.x+x>=this.ub.dm.canvasColumns-1||this.ub.board[this.y+y]&&this.ub.board[this.y+y][this.x+x+1]!==this.ub.dm.defBg)){return true}}}return false}},{key:'collisionWallLeft',value:function collisionWallLeft(){for(var y=0;y<this.shape.length;y++){for(var x=0;x<this.shape[y].length;x++){if(this.shape[y][x]&&(this.x+x<=0||this.ub.board[this.y+y]&&this.ub.board[this.y+y][this.x+x-1]!==this.ub.dm.defBg)){return true}}}return false}},{key:'collisionBlock',value:function collisionBlock(){var _this=this;for(var y=0;y<this.shape.length;y++){for(var x=0;x<this.shape[y].length;x++){if(!this.shape[y][x])continue;if(this.ub.board[this.y+y+1]&&this.ub.board[this.y+y+1][this.x+x]!==this.ub.dm.defBg||this.y+y+1>=this.ub.dm.canvasLines){if(this.y<0){(function(){_this.ub.dm.gameOver=true;var self=_this;var button=_this.bs;var socket=io.connect('http://localhost:8098');socket.on('lower-point',function(data){if(self.ub.dm.points>=data){var xhr=new XMLHttpRequest;var formData='nl='+self.ub.dm.points;xhr.open('post','/allow-sign');xhr.setRequestHeader('Content-type','application/x-www-form-urlencoded');xhr.onreadystatechange=function(){if(xhr.status===200){setTimeout(function(){window.location.href='/submit-name'},2000)}else{console.log('error allow sign')}};xhr.send(formData);self.ub.dm.activeButton=false;button.innerHTML='YOU ARE IN THE TOP TEN!<br>wait a sec to insert your name';socket.disconnect()}else{self.ub.dm.activeButton=true;button.innerHTML='you have done '+self.ub.dm.points+' lines <br> Click to play again'}button.style.fontSize='15px';button.style.paddingTop='48px';button.style.height='82px';button.style.display='block'});socket.emit('ask-lower-point')})()}this.ub.drawBoard(this.x,this.y,this.color,this.shape);this.ub.countLines();this.initPiece();return true}}}return false}},{key:'canRotate',value:function canRotate(){for(var y=0;y<this.shape.length;y++){for(var x=0;x<this.shape[y].length;x++){var line=this.ub.board[this.y+y];var holes=[];var hole=[];for(var z in line){if(line[z].toString()===this.ub.dm.defBg){hole.push(Number(++z));if(z===line.length){holes.push(hole);hole=[]}}else{if(hole.length>0){holes.push(hole)}hole=[]}}console.log(holes);var r=this.rotation<this.currentPiece.shape.length-1?this.rotation+1:0;var np=this.currentPiece.shape[r];for(var _hole in holes){if(this.x>=Number(holes[_hole][0])&&this.x<=Number(holes[_hole][holes[_hole].length-1])){if(np[0].length>=holes[_hole].length){return true}}}}}return false}}]);return Piece}()}();
